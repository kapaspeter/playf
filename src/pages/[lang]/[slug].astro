---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ReservationForm from '../../components/ReservationForm.tsx';
import PhotoGallery from '../../components/PhotoGallery.tsx';
import { useTranslations } from '../../utils/i18n';

export const prerender = true;

export async function getStaticPaths() {
  const pages = await getCollection('pages');
  return pages
    .filter(page => !page.data.draft && !page.id.includes('home'))
    .map(page => {
      const parts = page.id.split('/');
      if (parts.length < 2) return null;
      const lang = parts[0];
      const slug = page.data.slug || parts.slice(1).join('/');
      return {
        params: { lang, slug },
        props: { page },
      };
    })
    .filter(p => p !== null);
}

const { page } = Astro.props;
const { lang, slug } = Astro.params;
const { Content } = await render(page);
---

<Layout 
  title={page.data.title}
  MetaKeywords={page.data.MetaKeywords}
  MetaDescription={page.data.MetaDescription}
>
	<main class="container">
		<h1>{page.data.title}</h1>
		<Content />
    {page.id.includes('reservation') && <ReservationForm lang={lang as any} client:load />}
    {page.id.includes('gallery') && <PhotoGallery client:load />}
	</main>
</Layout>